---
title: "Billboard Data Analysis "
author: "Johan Hamsa & Ishaan Gupta"
date: "`r format(Sys.Date(), '%A, %B %e %Y')`"
output: 
  html_document: default 
  pdf_document: default
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  message = FALSE,
  warning = TRUE)

```

## Load packages 

```{r pkgs, warning = FALSE}

library(tidyverse)
library(knitr)
library(broom)
library(kableExtra)
library(data.table)
```

## Data description 

In this assignment, we scrap our music data from https://www.billboard.com/. The billboard charts calculate the weekly popularity of all songs and albums released in the United States. These metrics are derived from a combination of sources, including the number of singles sales, digital downloads,  and a wide array of streaming vehicles (i.e. such as youtube and Spotify). We will primarily investigate the Billboard year-end "Hot 100" and top "200 Albums" charts, alongside the decade-end data provided by the organisation. Our data analysis will primiarly be centered on the below questions: 

* Is there a correlation between singles success and album popularity? 
* Which artists were most dominant across the decade? 
* Who were the up & coming artists in the 2010s? 
* How heavily weighted are digital sales, radio success and streams in the calculation of position on the hot 100 charts? 

## Reading the csv data files 

```{r csv-read-data}

hot_100 <- read_csv(here::here("data/hot_100.csv"))
albums <- read_csv(here::here("data/albums.csv"))
digital_sales <- read_csv(here::here("data/digital_sales.csv"))
radio <- read_csv(here::here("data/radio.csv"))
streams <- read_csv(here::here("data/streams.csv"))

```

## Top 25 Solo Artists through the 2010s 

```{r top-25-2010s}

top_25_2010s <- function(billboard){

total_points <- 
  billboard %>% 
  group_by(Artist) %>%
  summarise_at(vars(Points),
               list(Points = sum)) %>% 
  arrange(desc(Points))

ranked <- 
  total_points %>%
  mutate(Rank = 1:nrow(total_points)) %>% 
  filter(Rank <= 25)

ggplot(data = ranked, 
       aes(x = Points,
           y = reorder(Artist, Points)
           )) + 
geom_col(fill = "steelblue4") +
labs(x = "Points", y = "Artist")

}

top_25_2010s(hot_100)
top_25_2010s(albums)
top_25_2010s(radio)
top_25_2010s(streams)
top_25_2010s(digital_sales)

```

### Annual score function    

```{r top-artists-function}

annual_score <- function(billboard){ 
  
points <- 
  billboard %>% 
  group_by(Artist, Year) %>% 
  summarise_at(vars(Points),
               list(Points = sum)) %>% 
  arrange(Year,
          desc(Points)) %>% 
  group_by(Year)

}

hot_100_annual <- annual_score(hot_100)

``` 

## Billboard Hot 100 Top 10 Artists over the years

### Tidying the Billboard Hot 100 annual score data 

```{r tidy-annual-score-data-hot-100}

t10_artists_h100_wide <- 
  annual_score(hot_100) %>% 
  pivot_wider(names_from = "Year", values_from = "Points") %>% 
  replace(is.na(.), 0) %>% 
  mutate(Aggregate = rowSums(.[2:11])) %>% 
  arrange(desc(Aggregate)) %>% 
  top_n(10) 

t10_artists_h100_long <- 
  t10_artists_h100_wide %>% 
  pivot_longer(cols = -Artist, 
               names_to = "Year", 
               values_to = "Points") %>% 
  filter(!str_detect(Year, "Aggregate")) %>% 
  group_by(Artist) %>% 
  mutate(cum_Points = cumsum(Points))

```

### Billboard Hot 100 - ggplot 

```{r ggplot-top-10-artists-h100} 

ggplot(data = t10_artists_h100_long, 
       aes(x = Year, 
           y = Points,
           colour = Artist)) + 
  geom_line(aes(group = Artist)) + 
  facet_wrap(~Artist, ncol = 5, nrow = 2) + 
  scale_x_discrete(breaks = c("2014","2019")) + 
  labs(title = "Billboard Hot 100 - Top 10 Artists Annual Success") + 
  theme(legend.position = "none")

ggplot(data = t10_artists_h100_long,
       aes(x = Year, 
           y = cum_Points, 
           colour = Artist)) + 
  geom_line(aes(group = Artist)) + 
  facet_wrap(~Artist, ncol = 5, nrow = 2) + 
  scale_x_discrete(breaks = c("2014", "2019")) + 
  labs(title = "Billboard Hot 100 - Top 10 Artists Cumulative Success") + 
  theme(legend.position = "none")

```

## Billboard Albums Top 10 Artists over the years 

### Tidying the Billboard Albums annual score data 
```{r tidy-annual-score-data-albums}

t10_artists_albums_wide <- 
  annual_score(albums) %>% 
  pivot_wider(names_from = "Year", values_from = "Points") %>% 
  replace(is.na(.), 0) %>% 
  mutate(Aggregate = rowSums(.[2:11])) %>% 
  arrange(desc(Aggregate)) %>% 
  top_n(12) 

t10_artists_albums_long <- 
  t10_artists_albums_wide %>% 
  pivot_longer(cols = -Artist, 
               names_to = "Year", 
               values_to = "Points") %>% 
  filter(!str_detect(Year, "Aggregate")) %>% 
  group_by(Artist) %>% 
  mutate(cum_Points = cumsum(Points))

```

### Billboard Albums - ggplot 
```{r ggplot-top-10-artists-albums}

ggplot(data = t10_artists_albums_long, 
       aes(x = Year, 
           y = Points,
           colour = Artist)) + 
  geom_line(aes(group = Artist)) + 
  facet_wrap(~Artist, ncol = 5) + 
  scale_x_discrete(breaks = c("2014","2019")) + 
  labs(title = "Billboard Albums - Top 10 Artists Annual Success") + 
  theme(legend.position = "none")

ggplot(data = t10_artists_albums_long,
       aes(x = Year, 
           y = cum_Points, 
           colour = Artist)) + 
  geom_line(aes(group = Artist)) + 
  facet_wrap(~Artist, ncol = 5) + 
  scale_x_discrete(breaks = c("2014", "2019")) + 
  labs(title = "Billboard Albums - Top 10 Artists Cumulative Success") + 
  theme(legend.position = "none")

```

## Evaluating the correlation between the Hot 100s ranking in terms of radio, streaming and digital sales success 

```{r h100-regression}
join <- function(hot_100, radio, streams, digital_sales){
  
  
t1_t2 <- 
  left_join(hot_100, radio, by = c("Title", "Artist", "Year")) %>% 
  rename(Hot_100 = Points.x,
         Radio = Points.y,
         Rank = Rank.x) %>% 
  select(-Rank.y)


t1_t3 <- 
  left_join(t1_t2, streams, by = c("Title", "Artist", "Year")) %>% 
  rename(Rank = Rank.x,
         Streams = Points) %>% 
  select(-Rank.y)

t1_t4 <- 
  left_join(t1_t3, digital_sales, by = c("Title", "Artist", "Year")) %>% 
  rename(Rank = Rank.x,
         Digital_sales = Points) %>% 
  select(-Rank.y)

}

h100_regression <- 
  join(hot_100, radio, streams, digital_sales) %>% 
  replace(is.na(.), 0) %>% 
  filter(Year >= 2013)

```

### Summary statistics 

```{r h100-linear-model}

lm_h100 <- lm(Hot_100 ~ Radio + Streams + Digital_sales, data = h100_regression)
lm_h100

aug_h100 <- augment(lm_h100, h100_regression)
broom::glance(lm_h100)
  
``` 

### Plotting the fitted values against the Hot 100 data
```{r h100-fitted-ggplot}

h100_fitted <- ggplot(data = aug_h100, 
       aes(x = Hot_100, 
           y = .fitted)) + 
  geom_point() + 
  geom_smooth(method = "lm") 

h100_fitted

```

### Plotting the standardised residuals against the Hot 100 data 

```{r h100-residuals-ggplot}

h100_residuals <- ggplot(data = aug_h100,
       aes(x = Hot_100, 
           y = .std.resid)) + 
  geom_smooth() + 
  geom_hline(yintercept = 0, 
             colour = "black",
             linetype = "dotted",
             size = 0.75)

h100_residuals

```
